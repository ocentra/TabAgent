console.log("[Offscreen Script Start] Executing offscreen.js");let e=null;const n="scraping-iframe";console.log("[Offscreen Script] Adding runtime.onMessage listener...");chrome.runtime.onMessage.addListener((r,c,o)=>{if(console.log("Offscreen: Received message:",r),r.target!=="offscreen"&&r.type!=="createIframe"&&r.type!=="removeIframe")return console.log("Offscreen: Ignoring message not intended for iframe document:",r.type),!1;switch(r.type){case"createIframe":if(console.log("[Offscreen] ENTERING createIframe handler..."),console.log(`[Offscreen] Handling createIframe for URL: ${r.url}`),e&&(console.warn("[Offscreen] Iframe already exists. Removing old one before creating new."),e.remove(),e=null),!r.url||!r.url.startsWith("http"))return console.error("[Offscreen] Invalid URL received for createIframe."),o({success:!1,error:"Invalid URL provided for iframe."}),!1;try{e=document.createElement("iframe"),e.id=n,e.src=r.url,e.style.position="absolute",e.style.width="1px",e.style.height="1px",e.style.left="-9999px",e.style.top="-9999px",e.style.border="none",document.body.appendChild(e),console.log("[Offscreen] Iframe created and appended."),o({success:!0})}catch(f){return console.error("[Offscreen] Error creating iframe:",f),o({success:!1,error:`Failed to create iframe: ${f.message}`}),e&&e.remove(),e=null,!1}return!1;case"removeIframe":if(console.log("[Offscreen] Handling removeIframe."),e)try{e.remove(),console.log("[Offscreen] Iframe removed successfully."),e=null,o({success:!0})}catch(f){console.error("[Offscreen] Error removing iframe:",f),o({success:!1,error:`Failed to remove iframe: ${f.message}`})}else console.warn("[Offscreen] No iframe found to remove."),o({success:!1,error:"No iframe exists to remove."});return!1;default:return console.log("[Offscreen] Received unhandled message type:",r==null?void 0:r.type),!1}});console.log("Offscreen script (Parsing/Iframe) loaded and listener added.");
